<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IVSmoke: Voxel Volume Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IVSmoke<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_pages_2_voxel_volume_2_voxel_volume_guide.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Voxel Volume Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md137"></a></p>
<p><span class="tt"><a class="el" href="class_a_i_v_smoke_voxel_volume.html">AIVSmokeVoxelVolume</a></span> is the central actor of the <a class="el" href="class_i_v_smoke.html">IVSmoke</a> plugin. It is responsible for the simulation, management, and replication of physically aware volumetric smoke.</p>
<p>Unlike traditional particle-based smoke, this actor utilizes a <b>voxel-based deterministic flood-fill algorithm</b>. This allows the smoke to naturally expand into spaces, flow around corners, and be blocked by walls, creating high-fidelity tactical concealment without clipping through geometry.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md138"></a>
Core Concepts</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md139"></a>
Volumetric Flood-Fill</h2>
<p>The volume generates a 3D grid of voxels. Starting from the center, the smoke performs a Dijkstra-based pathfinding expansion.</p>
<ul>
<li><b>Obstacle Awareness:</b> Before a voxel is spawned, the simulation performs collision checks (<span class="tt">VoxelCollisionChannel</span>) against the world geometry.</li>
<li><b>Volumetric Flow:</b> If a direct path is blocked by a wall, the smoke will "flow" around the obstacle to fill the space behind it, provided there is an open path.</li>
<li><b>Natural Shape:</b> By applying <span class="tt">ExpansionNoise</span> to the pathfinding cost, the smoke creates irregular, organic shapes rather than perfect spheres.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md140"></a>
Deterministic Networking</h2>
<p>To maintain high performance and low bandwidth usage, <b>voxel data is never replicated</b>.</p>
<p>Instead, the simulation is fully deterministic:</p>
<ol type="1">
<li><b>Server Authority:</b> The server selects a <span class="tt">RandomSeed</span> and a synchronized <span class="tt">StartTime</span>.</li>
<li><b>Replication:</b> Only the simulation <em>state</em> (Seed, Time, Phase) is sent to clients.</li>
<li><b>Local Simulation:</b> Clients run the exact same flood-fill algorithm locally using the replicated seed. This ensures every client sees the exact same smoke shape without sending array data across the network.</li>
</ol>
<blockquote class="doxtable">
<p><b>CRITICAL: Network Determinism &amp; Collision Channels</b> The simulation is <b>deterministic</b>, meaning clients calculate the smoke shape locally to save bandwidth. However, they rely on the world geometry being identical to the server. </p>
</blockquote>
<p>If you set the <span class="tt">VoxelCollisionChannel</span> to detect <b>Dynamic Objects</b> (e.g., destructible walls, moving doors, or vehicles), you <b>MUST</b> ensure those objects are perfectly synchronized (replicated) across the network.</p>
<ul>
<li><b>Risk:</b> If a door is open on the Server but closed on a Client (due to lag or lack of replication), the smoke will flow through the door on the Server but be blocked on the Client.</li>
<li><b>Result:</b> This causes a "Desync," where players see smoke in different locations, breaking competitive integrity.</li>
<li><b>Recommendation:</b> It is safest to use <span class="tt">ECC_WorldStatic</span> or a custom channel dedicated to static level geometry.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md142"></a>
Simulation Lifecycle</h1>
<p>The actor operates on a state machine (<span class="tt">EIVSmokeVoxelVolumeState</span>) that progresses based on duration settings.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md143"></a>
1. Expansion Phase</h2>
<ul>
<li><b>Behavior:</b> The smoke actively spawns new voxels, expanding outward from the center.</li>
<li><b>Control:</b> The rate of expansion is controlled by the <span class="tt">ExpansionCurve</span> and <span class="tt">ExpansionDuration</span>.</li>
<li><b>Visuals:</b> Voxels fade in based on <span class="tt">FadeInDuration</span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md144"></a>
2. Sustain Phase</h2>
<ul>
<li><b>Behavior:</b> The smoke has reached its maximum size (or <span class="tt">MaxVoxelNum</span> limit). It maintains its shape and density.</li>
<li><b>Duration:</b> Controlled by <span class="tt">SustainDuration</span>. If <span class="tt">bIsInfinite</span> is true, it remains in this state indefinitely.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md145"></a>
3. Dissipation Phase</h2>
<ul>
<li><b>Behavior:</b> The smoke begins to recede. Voxels are removed effectively in the reverse order of their generation (or based on noise), simulating the smoke thinning out.</li>
<li><b>Control:</b> The rate of removal is controlled by <span class="tt">DissipationCurve</span> and <span class="tt">DissipationDuration</span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md146"></a>
4. Finished</h2>
<ul>
<li><b>Behavior:</b> All voxels are removed.</li>
<li><b>Cleanup:</b> If <span class="tt">bDestroyOnFinish</span> is enabled, the actor is destroyed. Otherwise, it resets to an Idle state.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md148"></a>
Configuration Guidelines</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md149"></a>
Performance &amp; Resolution</h2>
<p>The visual fidelity and performance cost are managed by balancing the physical size of the voxels against the total number of voxels allowed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Property</b>  </th><th class="markdownTableHeadNone"><b>Description</b>  </th><th class="markdownTableHeadNone"><b>Impact</b>  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Voxel Size</b>  </td><td class="markdownTableBodyNone">The physical scale of a single voxel (in cm).  </td><td class="markdownTableBodyNone"><b>Visual Resolution.</b> Changing this <em>does not</em> affect performance (CPU/GPU) directly. It simply scales the resulting mesh.  </td></tr>
</table>
<p>• <b>Large Value:</b> Covers a large area cheaply, but looks "blocky." • <b>Small Value:</b> Finer detail. To cover a large area with small voxels, you must increase <span class="tt">MaxVoxelNum</span>. | | <b>Max Voxel Num</b> | The hard limit on the number of active voxels. | <b>Performance Budget.</b> This is the primary factor for CPU simulation cost. | | <b>Volume Extent</b> | The grid index radius. | <b>Memory Usage.</b> Defines the maximum memory buffer size. Keep this optimized (e.g., 8-16) to minimize memory footprint. |</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md150"></a>
Shape Control</h2>
<p>The overall shape of the smoke cloud is defined by the <b>Radii</b> and <b>Noise</b> settings.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md151"></a>
Radii (Aspect Ratio)</h2>
<p><span class="tt">Radii</span> defines the <b>relative shape ratio</b> of the expansion per axis. These are not absolute units; they function as weights for the flood-fill propagation.</p>
<ul>
<li><b>Examples:</b><ul>
<li><span class="tt">(1.0, 1.0, 1.0)</span> : Creates a <b>Sphere</b>.</li>
<li><span class="tt">(2.0, 2.0, 2.0)</span> : Also creates a <b>Sphere</b> (since the ratios are identical).</li>
<li><span class="tt">(2.0, 1.0, 1.0)</span> : Creates an <b>Ellipsoid</b> that stretches twice as far along the X-axis compared to Y and Z.</li>
<li><span class="tt">(1.0, 1.0, 0.5)</span> : Creates a flattened "pancake" shape.</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md152"></a>
Expansion Noise</h2>
<p>Adds randomness to the pathfinding cost.</p>
<ul>
<li><b>Low Value:</b> The smoke expands in a smooth, predictable geometric shape.</li>
<li><b>High Value:</b> The smoke becomes jagged and irregular, seeping into cracks and forming a more organic cloud.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md154"></a>
Network Synchronization</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md155"></a>
Late-Join Handling (Fast Forwarding)</h2>
<p>A common challenge with deterministic simulations is handling clients who join the game after the smoke has already started.</p>
<p><span class="tt"><a class="el" href="class_a_i_v_smoke_voxel_volume.html">AIVSmokeVoxelVolume</a></span> handles this automatically:</p>
<ul>
<li>When a client receives the state, it checks the server's <span class="tt">Generation</span> count.</li>
<li>If the client is behind, it triggers a <b>Fast-Forward</b> routine.</li>
<li>The client internally simulates the elapsed time in a tight loop to catch up to the server's current state instantly.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md156"></a>
Time Synchronization</h2>
<p>The simulation relies on <span class="tt">GetSyncWorldTimeSeconds()</span> to ensure that the expansion animation plays at the exact same world-time timestamp on all clients, compensating for network latency.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md158"></a>
Interaction Components</h1>
<p>This actor coordinates with helper components to handle gameplay interactions:</p>
<ol type="1">
<li><b>Hole Generator (<span class="tt"><a class="el" href="class_u_i_v_smoke_hole_generator_component.html" title="Component that generates hole texture for volumetric smoke. Provides public API for penetration and e...">UIVSmokeHoleGeneratorComponent</a></span>):</b><ul>
<li>Handles dynamic modifications to the smoke texture (e.g., when a grenade explodes inside the smoke or a projectile passes through).</li>
<li>This is purely visual and does not alter the voxel grid topology.</li>
</ul>
</li>
<li><b>Collision Component (<span class="tt"><a class="el" href="class_u_i_v_smoke_collision_component.html">UIVSmokeCollisionComponent</a></span>):</b><ul>
<li>Generates physics collision bodies based on the active voxels.</li>
<li><b>Usage:</b> Primarily used for <b>AI Perception blocking</b>. It allows AI to understand that they cannot see through the smoke volume.</li>
</ul>
</li>
</ol>
<blockquote class="doxtable">
<p><b>Interaction vs. Simulation</b> Do not confuse <span class="tt">VoxelCollisionChannel</span> (Settings) with <span class="tt"><a class="el" href="class_u_i_v_smoke_collision_component.html">UIVSmokeCollisionComponent</a></span> (Component). </p>
</blockquote>
<ul>
<li><b>VoxelCollisionChannel:</b> Used by the <em>simulation</em> to detect walls and stop expansion.</li>
<li><b><a class="el" href="class_u_i_v_smoke_collision_component.html">UIVSmokeCollisionComponent</a>:</b> Created by the <em>simulation</em> to block other actors (like AI Line of Sight).</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md160"></a>
Debugging</h1>
<div class="image">
<img src="VoxelVolume_image.png" alt=""/>
<div class="caption">
VoxelVolume_image.png</div></div>
    <p>The class includes robust editor and runtime debugging tools located under <span class="tt">Debug Settings</span>.</p>
<ul>
<li><b>Preview Simulation:</b> In the Editor Details panel, use <span class="tt">StartPreviewSimulation</span> to visualize the smoke expansion without entering Play Mode.</li>
<li><b>Visualizers:</b><ul>
<li><b>Wireframe:</b> Draws the bounds of active voxels.</li>
<li><b>Heatmap:</b> Colors voxels based on their generation order (useful for debugging expansion logic).</li>
<li><b>Status Text:</b> Displays the current State, Active Voxel Count, and the deterministic Checksum.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>Note on Checksums: The debug text displays a CRC32 Checksum. If you suspect a desync issue, compare this number between the Server and Client. They must match exactly. </p>
</blockquote>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md162"></a>
Console Commands (CVars)</h2>
<p>You can control debug visualizations at runtime using the console (<span class="tt">~</span> key). These commands affect <b>all</b> active <span class="tt"><a class="el" href="class_a_i_v_smoke_voxel_volume.html">AIVSmokeVoxelVolume</a></span> actors in the world simultaneously.</p>
<p>All commands share the prefix: <b><span class="tt">IVSmoke.Volume.</span></b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command  </th><th class="markdownTableHeadNone">Arguments  </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">IVSmoke.Volume.Debug</span></b>  </td><td class="markdownTableBodyNone"><span class="tt">0</span> or <span class="tt">1</span>  </td><td class="markdownTableBodyNone"><b>Master Switch.</b> Toggles the entire debug system on or off. Setting this to 0 hides all visualizations immediately.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">IVSmoke.Volume.ShowWireframe</span></b>  </td><td class="markdownTableBodyNone"><span class="tt">0</span> or <span class="tt">1</span>  </td><td class="markdownTableBodyNone">Toggles the lightweight wireframe cube visualization for active voxels.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">IVSmoke.Volume.ShowMesh</span></b>  </td><td class="markdownTableBodyNone"><span class="tt">0</span> or <span class="tt">1</span>  </td><td class="markdownTableBodyNone">Toggles the Instanced Static Mesh visualization. <b>Warning:</b> Rendering thousands of meshes can be expensive.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b><span class="tt">IVSmoke.Volume.ShowStatus</span></b>  </td><td class="markdownTableBodyNone"><span class="tt">0</span> or <span class="tt">1</span>  </td><td class="markdownTableBodyNone">Toggles the floating status text (State, Voxel Count, Checksum) above the actor.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b><span class="tt">IVSmoke.Volume.SetViewMode</span></b>  </td><td class="markdownTableBodyNone"><span class="tt">Mode ID</span>  </td><td class="markdownTableBodyNone">Changes visualization color. Use <b><span class="tt">0</span></b> for Solid Color (default) or <b><span class="tt">1</span></b> for Heatmap (gradient based on generation order).  </td></tr>
</table>
<hr  />
<p><em>Copyright (c) 2026, Team SDB. All rights reserved.</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
